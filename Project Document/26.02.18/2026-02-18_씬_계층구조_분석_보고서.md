# 씬 계층 구조 및 좌표 전수 조사 보고서 (2026-02-18)

본 문서는 3D 씬 내의 하드코딩된 공간적 종속성을 전수 조사하여, 시각적/물리적 일관성을 유지하면서 유연한 부모-자식 계층 구조로 리팩토링하기 위한 분석 자료입니다.

## 🏛️ 월드 좌표 매트릭스 (현재 상태)

| 컴포넌트 | 현재 월드 좌표 | 종속성 유형 | 관련 파일 |
| :--- | :--- | :--- | :--- |
| **포커 테이블** | `[0, 0, -3]` | 씬의 기준점 | [Table3D.tsx](file:///c:/Users/SAYOON/Documents/holdem-three-project/src/components/Table/Table3D.tsx) |
| **커뮤니티 보드** | `[0, 0, -3]` | 시각/로직 | [CommunityBoard3D.tsx](file:///c:/Users/SAYOON/Documents/holdem-three-project/src/components/Table/CommunityBoard3D.tsx) |
| **카드 덱** | `[-1.5, 0.4, -1.0]` | 물리/딜링 | [CardDeck3D.tsx](file:///c:/Users/SAYOON/Documents/holdem-three-project/src/components/Card/CardDeck3D.tsx) |
| **칩 보관함(Tray)** | `[2.2, 0, 3.5]` | 상호작용/환불 | [Scene3D.tsx](file:///c:/Users/SAYOON/Documents/holdem-three-project/src/components/Scene3D/Scene3D.tsx) |
| **플레이어 손패** | `[0, 0.7, 3.0]` | 드래그/물리 | [InteractiveHand3D.tsx](file:///c:/Users/SAYOON/Documents/holdem-three-project/src/components/Card/InteractiveHand3D.tsx) |
| **카메라 타겟** | `[0, 0, -3]` | 뷰포트 중심 | [Scene3D.tsx](file:///c:/Users/SAYOON/Documents/holdem-three-project/src/components/Scene3D/Scene3D.tsx) |
| **스포트라이트** | `[0, 10, -3]` | 조명 중심 | [Scene3D.tsx](file:///c:/Users/SAYOON/Documents/holdem-three-project/src/components/Scene3D/Scene3D.tsx) |

---

## 🔍 상세 종속성 분석

### 1. 테이블 앵커 (`z = -3`)의 중복
현재 게임의 시각적 중심이 `-3` 위치에 고정되어 있어, 여러 형제 컴포넌트들이 이 위치를 맞추기 위해 각각 `-3`이라는 오프셋을 개별적으로 들고 있습니다.
- **조명 및 카메라**: 테이블을 비추기 위해 직접 `-3` 좌표를 타겟팅함.
- **베팅 구역**: 보이지 않는 충돌 벽체들이 월드 좌표 0을 기준으로 계산되어 테이블과 따로 놂.

> [!IMPORTANT]
> **계층 구조화 방안**: `TableUnitGroup`을 `[0, 0, -3]`에 생성하고, 테이블 메쉬, 슬롯, 보드, 조명을 그 자식으로 배치하여 로컬 좌표 `0`을 사용하도록 변경.

### 2. 상호작용 로직의 좌표 의존성
일부 인터렉션 트리거가 월드 Z 좌표에 직접 묶여 있습니다.
- **카드 폴드**: 손패의 `z < 2.0`일 때 발동.
- **칩 던지기**: 칩의 `z < (생성위치 - 1.1)`일 때 발동 (최근 동적 개선됨).
- **칩 환불**: `Scene3D`에서 계산된 절대 월드 좌표로 직접 순간이동(Teleport) 시킴.

### 3. 좌표 불일치 및 오차
- **덱 높이**: 메쉬는 `y = 0.1`이나, 로직상 딜링 위치(`DECK_POSITION`)는 `y = 0.4`로 설정되어 있어 카드가 위에서 생성됨.
- **손패 높이**: 드래그 위치는 `y = 0.7`이나, 물리 레이캐스터 평면은 `-0.7`로 역방향 오프셋이 걸려 있음.

---

## 🗺️ 계층 구조화 로드맵 (Roadmap)

월드 좌표의 시각적 변화 없이 내부 구조만 유니티스타일의 GameObject 계층으로 전환하는 단계입니다:

1. **대그룹 형성 (Unit Grouping)**:
   - `TableUnit`: 테이블, 보드, 덱, 조명을 하나로 묶음 (`z = -3`).
   - `PlayerUnit`: 칩 보관함, 플레이어 손패를 하나로 묶음 (`z = 3.5`).
2. **로컬 좌표화 (Localization)**:
   - 부모가 `-3`으로 이동하면, 자식들의 내부 좌표를 `0` 또는 상대 좌표로 수정.
3. **물리 시스템 연동**:
   - Rapier의 `RigidBody`는 부모의 변형(Scale/Rotation)에 민감하므로, 그룹화 시에도 물리 연산은 월드 좌표계에서 정확히 이루어지도록 `getWorldPosition` 로직 유지.

---

## 📋 전수 조사 체크리스트 (TSX 파일 기준)

- [x] **Scene3D.tsx**: `DECK_POSITION`, `chipPositions`, 카메라 및 조명 타겟팅 전수 확인.
- [x] **Table3D.tsx**: 내부에 고정된 `-3` 오프셋 확인.
- [x] **CommunityBoard3D.tsx**: `boardZ` 변수의 `-3` 고정값 확인.
- [x] **InteractiveHand3D.tsx**: 드래그 시작점(`3.0`) 및 폴드 경계선(`2.0`) 확인.
- [x] **CardDeck3D.tsx**: 고정된 메쉬 위치 `[-1.5, 0.1, -1.0]` 확인.
