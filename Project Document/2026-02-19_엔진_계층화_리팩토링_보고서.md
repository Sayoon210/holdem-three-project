# 2026-02-19 포커 엔진 계층화 리팩토링 보고서 🚀

## 1. 개요
기존 `Scene3D.tsx`에 집중되어 있던 게임 로직, 소켓 통신, 그리고 3D 렌더링 책임을 분리하여 프로젝트의 유지보수성과 확장성을 확보함.

## 2. 변경된 아키텍처 (3-Layer)

### 🧱 Layer 1: Authoritative Server (`server/index.js`)
*   **권위적 서버**: 게임의 모든 수치(덱, 팟, 턴)를 관리하는 유일한 '진실의 근원'입니다.
*   **턴 관리**: 서버가 현재 누구의 차례인지 판단하고 모든 클라이언트에게 `turn_change` 이벤트를 방송합니다.
*   **보안**: 카드 정보를 보낼 때 본인에게만 실제 값을 보내고(`deal_private`), 타인에게는 카드의 존재만 알립니다(`deal_notify`).

### ⚙️ Layer 2: Poker Engine Hook (`usePokerEngine.ts`)
*   **논리 캡슐화**: 3D와 상관없는 모든 포커 로직(소켓 이벤트 수신, 상태 업데이트, 베팅 로직)을 이 훅에 가두었습니다.
*   **상태 추상화**: 씬 컴포넌트는 엔진에서 제공하는 단순한 데이터와 액션만 사용합니다.

### 🎨 Layer 3: Pure View (`Scene3D.tsx`)
*   **표현 계층**: 화면을 그리고 3D 오브젝트를 배치하는 역할에만 집중합니다.
*   **의존성 제거**: 복잡한 `useEffect`나 직접적인 `socket` 참조가 사라져 코드가 80% 이상 간결해졌습니다.

## 3. 상세 코드 점검 (Audit) 결과
*   **동기화**: `deal_notify`와 `deal_private`가 섞여서 와도 ID 기반으로 카드가 중복되지 않고 올바르게 교체됨을 확인.
*   **턴 제어**: 서버 주도형 턴 제어로 인해 클라이언트 간의 상태 불일치(Race Condition) 원천 차단.
*   **확장성**: 향후 3인 이상의 플레이어나 새로운 게임 룰 추가 시 서버와 엔진 훅만 수정하면 됨.

---
**작성자**: Antigravity AI  
**상태**: 리팩토링 완료 및 검증 완료
