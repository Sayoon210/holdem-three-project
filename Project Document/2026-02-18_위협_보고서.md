# 2026-02-18 프로젝트 성능 및 안정성 위협 보고서

본 보고서는 텍사스 홀덤 3D 프로젝트의 소스 코드를 전수 조사한 결과 발견된 잠재적 메모리 누수, 그래픽 리소스 과소비 및 성능 저하 요인을 정리한 문서입니다.

## ⚠️ 긴급도 수준 요약
- **심각(Critical)**: 메모리 누수 및 GPU VRAM 고갈 위험
- **높음(High)**: 프레임 드랍(FPS) 및 가비지 컬렉터(GC) 부하
- **보통(Normal)**: 코드 구조 개선 및 최적화 권장

---

## 1. 메모리 누수 및 VRAM 관리 (Critical)

### [완료] 카드 텍스처 복제 누수 (`Card3D.tsx`)
- **현상**: `useMemo` 내부에서 `frontTexture.clone()`을 호출하여 카드의 각 문양/숫자에 맞는 텍스처를 생성하고 있으나, 이전 텍스처에 대한 `dispose()` 처리가 누락되었습니다.
- **조치**: `useEffect` cleanup 함수를 통해 텍스처 파괴 시 `dispose()`를 호출하도록 수정 완료.

### [완료] 칩 모델 및 재질 복제 누수 (`InteractiveChip3D.tsx`)
- **현상**: `ChipModel` 컴포넌트 내부에서 `scene.clone()`과 `new MeshStandardMaterial()`을 `useMemo`로 생성하면서 역시 파괴 시(Unmount) 메모리 해제 로직이 없습니다.
- **조치**: 칩 모델과 커스텀 골드 재질에 대해 명시적 `dispose()` 로직 추가 완료.

---

## 2. CPU 및 프레임 최적화 (High)

### [완료] 렌더 루프 내 객체 과잉 생성 (`useFrame`)
- **현상**: `InteractiveChip3D.tsx`와 `InteractiveHand3D.tsx`의 `useFrame` 루프 내에서 매 프레임마다 수많은 객체가 새롭게 생성되고 있습니다.
- **조치**: 루프 외부에서 `useMemo`를 통해 객체를 1회 생성하고 재사용하는 패턴으로 변경 완료. GC 부하 대폭 감소.

---

## 3. 그래픽 리소스 가용성 (Normal)

### [완료] 과도한 섀도우 맵 해상도 (`Scene3D.tsx`)
- **현상**: 메인 조명의 섀도우 해상도가 `[2048, 2048]`로 설정되어 있습니다.
- **조치**: 1024 해상도로 낮추어 GPU 선점 메모리 최적화 완료.

### [보통] 중복 지오메트리 및 재질
- **현상**: 52장의 카드와 20개의 칩이 각각 독립적인 `boxGeometry`와 `meshBasicMaterial` 세트를 가집니다.
- **향후 과제**: `InstancedMesh` 도입을 통해 드로우 콜 최적화 검토 필요.

---

## 4. 물리 엔진 안정성 위협

### [보통] 타임아웃 기반 물리 상태 변경
- **현상**: 칩 환불 시 `setTimeout`을 사용하여 물리 상태를 전환하고 있습니다.
- **향후 과제**: 물리 엔진 이벤트 콜백을 통한 안정적인 전환 로직 고도화 필요.

---

## 5. 향후 개선 로드맵 (업데이트)

1. **Phase 1 [완료]**: 모든 복제 텍스처 및 재질에 `dispose()` 수명 주기 관리 적용
2. **Phase 2 [완료]**: `useFrame` 내 객체 할당을 제거하고 재사용 패턴으로 변경
3. **Phase 3**: 자산(Assets)의 인스턴싱(`InstancedMesh`) 적용 및 물리 엔진 콜백 정밀화

작성자: Antigravity AI
날짜: 2026-02-18
