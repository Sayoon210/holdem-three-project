# 2026-02-18 프로젝트 성능 및 안정성 위협 보고서

본 보고서는 텍사스 홀덤 3D 프로젝트의 소스 코드를 전수 조사한 결과 발견된 잠재적 메모리 누수, 그래픽 리소스 과소비 및 성능 저하 요인을 정리한 문서입니다.

## ⚠️ 긴급도 수준 요약
- **심각(Critical)**: 메모리 누수 및 GPU VRAM 고갈 위험
- **높음(High)**: 프레임 드랍(FPS) 및 가비지 컬렉터(GC) 부하
- **보통(Normal)**: 코드 구조 개선 및 최적화 권장

---

## 1. 메모리 누수 및 VRAM 관리 (Critical)

### [심각] 카드 텍스처 복제 누수 (`Card3D.tsx`)
- **현상**: `useMemo` 내부에서 `frontTexture.clone()`을 호출하여 카드의 각 문양/숫자에 맞는 텍스처를 생성하고 있으나, 이전 텍스처에 대한 `dispose()` 처리가 누락되었습니다.
- **위험**: 게임이 진행되어 새로운 카드가 계속 생성될 경우(셔플/새 게임), 사용되지 않는 이전 텍스처 오브젝트가 GPU 메모리에 계속 쌓여 브라우저가 강제 종료될 수 있습니다.
- **조치**: `useEffect`의 cleanup 함수에서 `texture.dispose()`를 명시적으로 호출해야 합니다.

### [심각] 칩 모델 및 재질 복제 누수 (`InteractiveChip3D.tsx`)
- **현상**: `ChipModel` 컴포넌트 내부에서 `scene.clone()`과 `new MeshStandardMaterial()`을 `useMemo`로 생성하면서 역시 파괴 시(Unmount) 메모리 해제 로직이 없습니다.
- **위험**: 칩 모델 전체가 복제되므로 카드보다 메모리 점유율이 훨씬 높으며, 반복적인 리렌더링 시 심각한 누수를 유발합니다.

---

## 2. CPU 및 프레임 최적화 (High)

### [높음] 렌더 루프 내 객체 과잉 생성 (`useFrame`)
- **현상**: `InteractiveChip3D.tsx`와 `InteractiveHand3D.tsx`의 `useFrame` 루프(초당 60~120회 실행) 내에서 `new THREE.Vector3()`, `new THREE.Plane()` 등 수많은 객체가 매 프레임마다 새롭게 생성되고 있습니다.
- **위험**: 이는 자바스크립트 가비지 컬렉터(GC)에 엄청난 부하를 주어 주기적인 "마이크로 스터터링(프레임 끊김)"의 원인이 됩니다.
- **조치**: 루프 외부에서 변수를 `useRef`나 상수로 미리 선언하고 `copy()`, `set()` 메서드를 사용하여 재사용해야 합니다.

---

## 3. 그래픽 리소스 가용성 (Normal)

### [보통] 과도한 섀도우 맵 해상도 (`Scene3D.tsx`)
- **현상**: 메인 조명의 섀도우 해상도가 `[2048, 2048]`로 설정되어 있습니다.
- **위험**: 고사양 PC에서는 문제가 없으나, 모바일 브라우저나 저사양 노트북 환경에서는 텍스처 메모리 대역폭을 과도하게 점유하여 발열 및 성능 저하를 일으킴.
- **조치**: 1024 정도로 낮추거나 `ContactShadows` 등을 적극 활용하여 시스템 부하를 줄일 수 있습니다.

### [보통] 중복 지오메트리 및 재질
- **현상**: 52장의 카드와 20개의 칩이 각각 독립적인 `boxGeometry`와 `meshBasicMaterial` 세트를 가집니다.
- **위험**: 드로우 콜(Draw Call) 횟수가 증가하여 렌더링 효율이 떨어집니다.
- **조치**: 공유 가능한 지오메트리는 외부에서 정의하여 참조하거나, `InstancedMesh` 도입을 검토해야 합니다.

---

## 4. 물리 엔진 안정성 위협

### [보통] 타임아웃 기반 물리 상태 변경
- **현상**: 칩 환불 시 `setTimeout`을 사용하여 `kinematic`에서 `dynamic`으로 강제 전환하고 있습니다.
- **위험**: React의 렌더링 사이클과 물리 엔진의 스텝(Step)이 맞지 않을 경우, 칩이 바닥을 뚫고 떨어지거나 튕겨 나가는 예외 상황이 발생할 수 있습니다.
- **조치**: 물리 엔진의 `onUpdate` 콜백이나 상태 플래그를 이용한 안전한 전환이 권장됩니다.

---

## 5. 향후 개선 로드맵

1. **Phase 1**: 모든 복제 텍스처 및 재질에 `dispose()` 수명 주기 관리 적용 (메모리 누수 차단)
2. **Phase 2**: `useFrame` 내 객체 할당을 제거하고 재사용 패턴으로 변경 (프레임 안정성 확보)
3. **Phase 3**: 자산(Assets)의 인스턴싱(`InstancedMesh`) 적용 및 섀도우 해상도 최적화

작성자: Antigravity AI
날짜: 2026-02-18
